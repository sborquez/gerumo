# ----------------SLURM Parameters----------------
#!/bin/bash
#SBATCH -p gpuk
#SBATCH -J gerumo_preprocessing
#SBATCH --mail-user=sebastian.borquez@sansano.usm.cl
#SBATCH --mail-type=ALL
#SBATCH -o logs/output_preprocessing_%j.log
#SBATCH -e logs/error_preprocessing_%j.log
#SBATCH --gres=gpu:1

# ----------------MÃ³dulos-----------------------------
cd $SLURM_SUBMIT_DIR
source /opt/software/anaconda3/2019.03/setup.sh
# ----------------Comandos--------------------------

source activate /data/atlas/dbetalhc/cta-test/gerumo/env/gerumo
echo "Running prepare_dataset.sh"
echo ""

cd /data/atlas/dbetalhc/cta-test/gerumo/src/gerumo/train

# Train small
## ls -d  ~/data/train/* | head -n 30
echo "Preprocessing Small"
python prepare_dataset.py -o  /data/atlas/dbetalhc/cta-test/gerumo/data/small -I /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs100-1155___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs101-1153___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs10-1152___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs102-1675___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs103-1049___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs105-1209___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs106-1260___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs107-1596___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs108-1411___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs111-1520___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs113-1465___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs1132-1577___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs114-1551___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs1157-1611___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs116-1376___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs1-1692___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs119-1059___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs11-958___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs120-1618___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs121-949___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs123-1694___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs126-1672___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs127-1583___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs1276-1602___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs128-1161___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs130-1259___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs131-1320___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs13-1317___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs132-1516___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5 /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train/gamma_20deg_0deg_runs133-1482___cta-prod3-demo_desert-2150m-Paranal-baseline_cone10.h5

# Train all
echo "Preprocessing All"
python prepare_dataset.py -o  /data/atlas/dbetalhc/cta-test/gerumo/data/train -i /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_train

# Test
echo "Preprocessing Test"
python prepare_dataset.py -o  /data/atlas/dbetalhc/cta-test/gerumo/data/test -i /data/atlas/dbetalhc/cta-test/Prod3_Paranal_Baseline_NSB1x_gamma-diffuse_North_20deg_DL1_ML2_test -s 0 
